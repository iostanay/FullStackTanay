<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Contact</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    .is-invalid {
      border-color: #dc3545 !important;
      box-shadow: 0 0 0 0.2rem rgba(220,53,69,.25);
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h2>Contact Me</h2>
    <form id="contactForm" novalidate>
      <div class="mb-3">
        <label for="name" class="form-label">Your Name</label>
        <input type="text" class="form-control" id="name" placeholder="Your Name" required>
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">Your Email</label>
        <input type="email" class="form-control" id="email" placeholder="your@email.com" required>
      </div>
      <div class="mb-3">
        <label for="message" class="form-label">Your Message</label>
        <textarea class="form-control" id="message" rows="5" placeholder="Type your message here..." required></textarea>
      </div>
      <button type="submit" id="submitBtn" class="btn btn-primary">
        <i class="fas fa-paper-plane me-2"></i>Send Message
      </button>
      <div id="formMessage" class="mt-3" style="display: none;"></div>
    </form>
  </div>

  <!-- JavaScript -->
  <script>
  (function () {
    function initContactForm() {
      const contactForm = document.getElementById('contactForm');
      const submitBtn = document.getElementById('submitBtn');
      const formMessage = document.getElementById('formMessage');

      if (!contactForm || !submitBtn) return;

      contactForm.addEventListener('submit', async function (e) {
        e.preventDefault();

        const nameField = document.getElementById('name');
        const emailField = document.getElementById('email');
        const messageField = document.getElementById('message');

        const name = nameField.value.trim();
        const email = emailField.value.trim();
        const message = messageField.value.trim();

        // Reset validation styles
        [nameField, emailField, messageField].forEach(field => field.classList.remove('is-invalid'));

        // Validate fields
        if (!name) {
          nameField.classList.add('is-invalid');
          return showMessage('Please enter your name.', 'error');
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email) {
          emailField.classList.add('is-invalid');
          return showMessage('Please enter your email.', 'error');
        } else if (!emailRegex.test(email)) {
          emailField.classList.add('is-invalid');
          return showMessage('Please enter a valid email address.', 'error');
        }

        if (!message || message.length < 10) {
          messageField.classList.add('is-invalid');
          return showMessage('Please enter a message (at least 10 characters).', 'error');
        }

        // Disable button while submitting
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';

        try {
          const res = await fetch("https://fullstacktanay-production.up.railway.app/api/contacts", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, message })
          });

          const data = await res.json();

          if (res.ok) {
            showMessage('✅ Message sent successfully!', 'success');
            contactForm.reset();
          } else {
            showMessage(data.error || '❌ Failed to send message.', 'error');
          }
        } catch (err) {
          console.error(err);
          showMessage('❌ Network error. Please try again.', 'error');
        } finally {
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>Send Message';
        }
      });

      function showMessage(msg, type) {
        formMessage.textContent = msg;
        formMessage.className = `alert alert-${type === 'success' ? 'success' : 'danger'} mt-3`;
        formMessage.style.display = 'block';

        setTimeout(() => {
          formMessage.style.display = 'none';
        }, type === 'success' ? 5000 : 8000);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initContactForm);
    } else {
      initContactForm();
    }
  })();
  </script>
</body>
</html>
